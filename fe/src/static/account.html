<!doctype html>
    <head>
        <link
            rel="icon"
            href="https://indexsupply.net/ga.png"
            type="image/x-icon"
        />
        <meta charset="utf-8" />
        <title>Index Supply / Account</title>
        <style>
        body {
            font-family: system, sans-serif;
            font-size: 0.95em;
            letter-spacing: -0.005em;
            line-height: 1.58;

            max-width: 800px;
            margin: 0 auto;
        }
        a:link,
        a:visited,
        a:hover,
        a:active {
            color: blue;
            text-decoration: none;
        }
        .navigation {
            width: 100%;
            padding: 10px;
            font-size: large;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            height: 30px;
        }
        .Success {
            color: green;
        }
        .Error {
            color: red;
        }
        #api-keys {
            width: 100%;
        }
        .api-key {
            width: 100%;
            display: flex;
            flex-direction: row;
        }
        .api-key:last-of-type {
            border-bottom: 1px solid black;
        }
        .api-key .header {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .api-key .secret {
            font-family: monospace;
            width: 40%;
            white-space: nowrap;
            display: inline-block;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .api-key .origins {
            text-align: left;
            width: 30%;
            white-space: nowrap;
            display: inline-block;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .api-key .created_at {
            text-align: left;
            width: 20%;
        }
        .api-key .delete {
            text-align: right;
            width: 10%;
        }
        #new-api-key {
            padding: 10px 0 0 0;
            text-align: right;
        }
        .plan {
            width: 100%;
        }
        .plan h3 {
            margin: 0px 0 5px 0;
            color: darkgrey;
            font-weight: normal;
            font-style: italic;
            text-transform: capitalize;
        }
        .menu {
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: flex-start;
            flex-grow: 1;
            gap: 20px;
            margin-bottom: 10px;
        }
        .menu h4 {
            font-size: large;
            font-weight: normal;
            text-align: center;
            padding-bottom: 12px;
            border-bottom: 2px solid black;
        }
        .option.selected {
            border: 5px solid green;
        }
        .option {
            width: 100%;
            box-sizing: border-box;
            border: 2px inset black;
            padding: 0 0 10px 0;
        }
        .option ul {
            padding-inline-start: 20px;
        }
        .option li {
            padding-left: 0px;
        }
        .option p {
            padding-left: 5px;
        }
        .option form {
            padding-left: 5px;
        }
        .option p.price span {
            padding-left: 5px;
            font-size: x-small;
        }
        .hidden {
            visibility: hidden;
        }
        .opaque {
            opacity: 10%;
        }
        .highlight {
            background-color: lightyellow;
        }
        </style>
    </head>
    <body>
        <div class="navigation">
            <div>
                {{#each flash }}
                <marquee class="{{level}}">{{ message }}</marquee>
                {{/each}}
            </div>
            <div>
                {{#with user}}
                <a href="/logout">log out</a>,
                <a href="/">home</a>
                {{else}}
                <a href="/login">log in</a>
                {{/with}}
            </div>
        </div>
        <div id="api-keys">
            <h2>API Keys</h2>
            <div id="keys">
            {{#if (gt (len api_keys) 0)}}
            <div class="api-key header">
                <div class="secret header"><span>key</span></div>
                <div class="origins header"><span>origins</span></div>
                <div class="created_at header"><span>created_at</span></div>
            </div>
            {{else}}
            <span>No API Keys</span>
            {{/if}}
            {{#each api_keys }}
            <div class="api-key">
                <div class="secret"><span>{{ secret }}</span></div>
                <div class="origins"><span>{{ (join origins ",") }}</span></div>
                <div class="created_at"><span>{{ created_at }}</span></div>
                <div class="delete"><a href="{{ secret }}">delete</a></div>
            </div>
            {{/each}}
            </div>
            <div id="new-api-key">
                <a href="/new-api-key">new api key</a>
            </div>
        </div>
        <div id="daimo-pay">
            <div class="plan">
                <h2>Plans</h2>
                {{#if plan}}
                <h3>Current: {{plan.name}}</h3>
                {{/if}}
                <div class="menu">
                    <div class="option" name="indie">
                        <h4>Indie</h4>
                        <ul>
                            <li>5 requests per second per client</li>
                            <li>10 connected clients</li>
                            <li>Best Effort Support</li>
                        </ul>
                        <p class="price">$400 per year<span>$33.33 per month</span></p>
                        <form action="/setup-daimo" method="POST">
                            <input type="hidden" name="plan_name" value="indie">
                            <button type="submit">Pay with Daimo</button>
                        </form>
                        <p>$50 per month</p>
                        <form action="/setup-stripe" method="POST">
                            <input type="hidden" name="plan_name" value="indie">
                            <button type="submit">Pay with Stripe</button>
                        </form>
                    </div>
                    <div class="option" name="pro">
                        <h4>Pro</h4>
                        <ul>
                            <li>10 requests per second per client</li>
                            <li>1,000 connected clients</li>
                            <li>Same Day Support</li>
                        </ul>
                        <p class="price">$2,800 per year<span>$233.33 per month</span></p>
                        <form action="/setup-daimo" method="POST">
                            <input type="hidden" name="plan_name" value="pro">
                            <button type="submit">Pay with Daimo</button>
                        </form>
                        <p>$250 per month</p>
                        <form action="/setup-stripe" method="POST">
                            <input type="hidden" name="plan_name" value="pro">
                            <button type="submit">Pay with Stripe</button>
                        </form>
                    </div>
                    <div class="option" name="unlimited">
                        <h4>Unlimited</h4>
                        <ul>
                            <li>Custom Chains</li>
                            <li>Custom Performance</li>
                            <li>On-call Support</li>
                        </ul>
                        <p class="price">$22,000 per year<span>$1,833.33 per month</span></p>
                        <form action="/setup-daimo" method="POST">
                            <input type="hidden" name="plan_name" value="unlimited">
                            <button type="submit">Pay with Daimo</button>
                        </form>
                        <p>$2,000 per month</p>
                        <form action="/setup-stripe" method="POST">
                            <input type="hidden" name="plan_name" value="unlimited">
                            <button type="submit">Pay with Stripe</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="card">
            <form action="/update-stripe" method="POST">
                <button type="submit">Update Stripe Card</button>
            </form>
        </div>
    </body>

    <script defer>

      function deleteApiKey(event) {
        event.preventDefault();
        const secret = this.getAttribute('href');
        if (!confirm(`delete api key: ${secret.substring(0,4)}...?`)) {
          return;
        }
        fetch("/delete-api-key", {
          method: "POST",
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(secret),
        }).then(response => {
          if (response.ok) {
            window.location.reload();
          } else {
            response.text().then(msg => {
              document.getElementById("error").textContent = msg;
            });
          }
        })
      };

      document.addEventListener("DOMContentLoaded", () => {
        {{#if plan}}
          document.querySelector('div.option[name="{{plan.name}}"]').classList.add("selected");
        {{/if}}

        document.querySelectorAll(".api-key:not(.header)").forEach(div => {
          div.addEventListener("mouseover", event => {
            div.classList.add("highlight");
          });
          div.addEventListener("mouseout", event => {
            div.classList.remove("highlight");
          });
        });

        document.querySelectorAll(".api-key .delete a").forEach(div => {
          div.addEventListener("click", deleteApiKey);
        });

        setTimeout(() => {
          document.querySelectorAll('marquee').forEach(el => {
            el.style.display = 'none';
          });
        }, 10000);
      });
    </script>
</html>
